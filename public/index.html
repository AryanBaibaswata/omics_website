<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="pipe.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Genome Assembly</title>
    <script
        type="module"
        src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/progress-indicator.min.js"></script>
    <style>
        .step {
            padding: 10px;
            border: 1px solid #000;
            margin: 5px;
            display: inline-block;
            border-radius: 5px;
        }
        .blinking {
            animation: blinkingBackground 1s infinite;
        }
        @keyframes blinkingBackground {
            0% { background-color: #fff; }
            50% { background-color: #ffff99; }
            100% { background-color: #fff; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="">
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/ee/AIIMS_New_Delhi.png" alt="Home" width="64">
        </a>
        <div class="navsec1">
            <h1>AIIMS OMICS TOOLBOX</h1>
        </div>
        <div class="navsec2">
            <img src="https://cmie-aiims.in/wp-content/uploads/2022/04/ccrf-logo.jpg" alt="India" width="64">
        </div>
    </nav>

    <div class='container'>
        <div class="topnav" id="myTopnav">
                <a href="landing.html">Home</a>
            <a href="reports.html" class="active">Reports</a>
            <a href="login.html">Login</a>
        </div>
    </div>
    <div class="form">
        <h1>Upload FASTQ Files</h1>
        <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="files" id="files" accept=".fastq.gz" multiple required>
            <br><br>
            <select name="genome" id="genome">
                <option value="hev">Hepatitis E</option>
                <option value="covid">Covid</option>
            </select>
            <button type="submit">Upload and Process</button>
        </form>
    </div>

    <h2>Pipeline Progress:</h2>
    <div id="wrapper">
      <div id="pipeline-container">
        <div class="pipeline-step" id="step-1">Step-1.0: FastQC Quality Control Report</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-2">Step-1.1: Fastp Quality Control</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-3">Step-2: Read Alignment</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-4">Step-3: Conversion Of Sam To BAM File</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-5">Step-4: Alignment Metrics</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-6">Step-5: Conversion of BAM To Sorted BAM</div>
        </div>
        <div id="pipeline-container">
        <div class="pipeline-step" id="step-7">Step-6: Deriving Low Coverage Bed File</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>

        <div class="pipeline-step" id="step-8">Step-7: Extracting Start End Coordinates</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-9">Step-8: Performing N-masking</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-10">Step-9: Removing Duplicate Reads</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-11">Step-10: Generation of VCF</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-12">Step-11: Generation of VCF Index</div>
        <svg class="arrow" width="50" height="50">
            <line x1="25" y1="0" x2="25" y2="50" style="stroke:#000;stroke-width:2" />
            <polygon points="20,45 25,55 30,45" style="fill:#000;" />
        </svg>
        <div class="pipeline-step" id="step-13">Step-12: Generation of Viral Genome Fasta</div>
        </div>
    
    
    <div class="bottom">
    <h2>Progress Log:</h2>
    <pre id="progress"></pre>
    </div>
</div>
    <script>
        const form = document.getElementById('uploadForm');
        const progress = document.getElementById('progress');
        const steps = {
            "FastQC Quality Control Report": "step-1",
            "Fastp Quality Control": "step-2",
            "Read Alignment": "step-3",
            "Conversion Of Sam To BAM File": "step-4",
            "Alignment Metrics": "step-5",
            "Conversion of BAM To Sorted BAM": "step-6",
            "Deriving Low Coverage Bed File": "step-7",
            "Extracting Start End Coordinates": "step-8",
            "Performing N-masking": "step-9",
            "Removing Duplicate Reads": "step-10",
            "Generation of VCF": "step-11",
            "Generation of VCF Index": "step-12",
            "Generation of Viral Genome Fasta": "step-13",
        };
        const updateProgress = (message) => {
            progress.textContent += message + '\n';
            for (const [step, id] of Object.entries(steps)) {
                const stepElement = document.getElementById(id);
                if (message.includes(step)) {
                    stepElement.classList.add('blinking');
                } else {
                    stepElement.classList.remove('blinking');
                }
            }
        };
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
            .then(data => {
                updateProgress(data.message);
            }).catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
